# Contrast Heatmap - ç³»çµ±æ¶æ§‹è¦åŠƒæ–‡ä»¶

## æ–‡ä»¶ç‰ˆæœ¬èˆ‡æ—¥æœŸ
- **ç‰ˆæœ¬**: 1.0.0
- **æ—¥æœŸ**: 2025å¹´12æœˆ
- **ä½œè€…**: ç³»çµ±æ¶æ§‹å¸«è¦–è§’åˆ†æ

---

## 1. é …ç›®æ¦‚è¿°

### 1.1 é …ç›®å®šä½
**Contrast Heatmap** æ˜¯ä¸€å€‹Chromeç€è¦½å™¨æ“´å±•ç¨‹åºï¼Œå°ˆæ³¨æ–¼**ç„¡éšœç¤™å¯è¨ªå•æ€§(Accessibility)** é ˜åŸŸçš„å·¥å…·é¡æ‡‰ç”¨ã€‚é€šéå¯¦æ™‚æƒæç¶²é ä¸­çš„æ–‡æœ¬å°æ¯”åº¦ï¼Œä¸¦ä½¿ç”¨**APCA(Advanced Perceptual Contrast Algorithm)** ç®—æ³•é€²è¡Œæº–ç¢ºçš„äººçœ¼æ„ŸçŸ¥è©•ä¼°ï¼Œç‚ºé–‹ç™¼è€…å’Œè¨­è¨ˆå¸«æä¾›è¦–è¦ºåŒ–çš„å°æ¯”åº¦ç†±åŠ›åœ–ã€‚

### 1.2 æ ¸å¿ƒç›®æ¨™
- æé«˜ç¶²é ç„¡éšœç¤™å¯è¨ªå•æ€§æª¢æ¸¬æ•ˆç‡
- åŸºæ–¼äººçœ¼æ„ŸçŸ¥è€Œéç´”æ•¸å­¸è¨ˆç®—çš„å°æ¯”åº¦è©•ä¼°
- æä¾›å¯¦æ™‚ã€è¦–è¦ºåŒ–ã€äº¤äº’å¼çš„å°æ¯”åº¦åˆ†æ
- æ”¯æŒå¤šèªè¨€å’Œä¸»é¡Œåˆ‡æ›ï¼Œæ“´å¤§ç”¨æˆ¶åŸºæ•¸

### 1.3 ä¸»è¦ç‰¹æ€§
| ç‰¹æ€§ | èªªæ˜ | å„ªå…ˆç´š |
|-----|------|------|
| APCAå°æ¯”åº¦åˆ†æ | æ¡ç”¨é«˜ç´šæ„ŸçŸ¥å°æ¯”åº¦ç®—æ³• | P0 |
| è¦–å£å„ªåŒ– | åªæƒæç•¶å‰å¯è¦‹å€åŸŸ | P0 |
| å¯¦æ™‚ç†±åŠ›åœ– | Canvaså‹•æ…‹æ¸²æŸ“ | P0 |
| æ»¾å‹•è‡ªå‹•æƒæ | é˜²æŠ–è™•ç†çš„å‹•æ…‹æ›´æ–° | P1 |
| å¤šèªè¨€æ”¯æŒ | è‹±æ–‡å’Œä¸­æ–‡ | P1 |
| æ·±è‰²æ¨¡å¼ | ç³»çµ±åå¥½æª¢æ¸¬+æ‰‹å‹•åˆ‡æ› | P1 |

---

## 2. ç³»çµ±æ¶æ§‹è¨­è¨ˆ

### 2.1 ç¸½é«”æ¶æ§‹åœ–

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Chrome Browser                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Content Script  â”‚  â”‚  Popup UI(React) â”‚  â”‚ Service    â”‚ â”‚
â”‚  â”‚  (Full Page)     â”‚  â”‚ (User Controls)  â”‚  â”‚ Worker     â”‚ â”‚
â”‚  â”‚                  â”‚  â”‚                  â”‚  â”‚ (Backgroundâ”‚ â”‚
â”‚  â”‚ â€¢ Scan Logic     â”‚  â”‚ â€¢ Language Ctrl  â”‚  â”‚ Handler)   â”‚ â”‚
â”‚  â”‚ â€¢ Canvas Render  â”‚  â”‚ â€¢ Theme Ctrl     â”‚  â”‚            â”‚ â”‚
â”‚  â”‚ â€¢ Scroll Handler â”‚  â”‚ â€¢ Enable Toggle  â”‚  â”‚            â”‚ â”‚
â”‚  â”‚ â€¢ DOM Traverse   â”‚  â”‚ â€¢ Opacity Slider â”‚  â”‚            â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚          â–²                      â”‚                    â–²       â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                         Message API                          â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚          â–¼                      â–¼                    â–¼       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚           Shared Utilities                              â”‚ â”‚
â”‚  â”‚  â€¢ color.js (APCAç®—æ³•, è‰²å½©è§£æ)                        â”‚ â”‚
â”‚  â”‚  â€¢ i18n.js (åœ‹éš›åŒ–, ä¸»é¡Œç®¡ç†)                           â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚          â–²                                                   â”‚
â”‚          â”‚         Chrome Storage API                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
      â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
      â”‚  Storage  â”‚
      â”‚  â€¢ å•Ÿç”¨ç‹€æ…‹  â”‚
      â”‚  â€¢ é€æ˜åº¦   â”‚
      â”‚  â€¢ èªè¨€     â”‚
      â”‚  â€¢ ä¸»é¡Œ     â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ¶æ§‹å±¤æ¬¡

#### **è¡¨ç¾å±¤ (Presentation Layer)**
- **Popup UI**: React 18 çµ„ä»¶ï¼Œæä¾›ç”¨æˆ¶äº¤äº’ç•Œé¢
- **Canvas Overlay**: åŸç”ŸHTML5 Canvasï¼Œæ¸²æŸ“ç†±åŠ›åœ–
- **è·è²¬**: UIäº¤äº’ã€ç”¨æˆ¶è¨­ç½®ã€è¦–è¦ºåé¥‹

#### **æ¥­å‹™é‚è¼¯å±¤ (Business Logic Layer)**
- **Content Script**: æ ¸å¿ƒæƒæå’Œæ¸²æŸ“å¼•æ“
- **Service Worker**: äº‹ä»¶è™•ç†å’Œè·¨æ¨™ç±¤é€šä¿¡å”èª¿
- **è·è²¬**: å°æ¯”åº¦è¨ˆç®—ã€DOMéæ­·ã€æ€§èƒ½å„ªåŒ–

#### **å·¥å…·å±¤ (Utility Layer)**
- **color.js**: APCAç®—æ³•å¯¦ç¾ã€è‰²å½©è§£æ
- **i18n.js**: åœ‹éš›åŒ–ã€ä¸»é¡Œç®¡ç†
- **è·è²¬**: é€šç”¨ç®—æ³•å’Œé…ç½®ç®¡ç†

#### **æ•¸æ“šå±¤ (Data Layer)**
- **Chrome Storage API**: æŒä¹…åŒ–å­˜å„²
- **è·è²¬**: ç”¨æˆ¶è¨­ç½®ä¿å­˜å’Œæ¢å¾©

---

## 3. æ ¸å¿ƒæ¨¡å¡Šè¨­è¨ˆ

### 3.1 Content Script æ¨¡å¡Š

**æ–‡ä»¶**: `src/content/index.js`

**æ ¸å¿ƒè·è²¬**:
1. ç›£è½ä¾†è‡ªPopupçš„æ§åˆ¶æ¶ˆæ¯
2. æƒæDOMæ¨¹ä¸¦è¨ˆç®—æ–‡æœ¬å°æ¯”åº¦
3. ç®¡ç†Canvasç†±åŠ›åœ–çš„ç”Ÿå‘½é€±æœŸ
4. è™•ç†æ»¾å‹•äº‹ä»¶ï¼Œå¯¦ç¾å‹•æ…‹æ›´æ–°

**é—œéµå‡½æ•¸è¨­è¨ˆ**:

| å‡½æ•¸ | è¼¸å…¥ | è¼¸å‡º | èªªæ˜ |
|------|------|------|------|
| `createCanvasOverlay()` | ç„¡ | Canvas DOMå…ƒç´  | å‰µå»ºä¸¦æ³¨å…¥å…¨é é¢canvas |
| `getEffectiveBackgroundColor(element)` | DOM Element | RGB Object | éæ­¸æŸ¥æ‰¾æœ‰æ•ˆèƒŒæ™¯è‰² |
| `getFontSize(element)` | DOM Element | 'large'\|'normal' | åˆ¤æ–·æ–‡æœ¬å¤§å°é¡åˆ¥ |
| `isElementInViewport(rect)` | DOMRect | Boolean | æª¢æŸ¥å…ƒç´ æ˜¯å¦åœ¨è¦–å£å…§ |
| `scanViewport()` | ç„¡ | ç„¡ | æƒæä¸¦æ¸²æŸ“ç•¶å‰è¦–å£ |
| `handleScroll()` | ScrollEvent | ç„¡ | é˜²æŠ–æ»¾å‹•è™•ç† |

**æ•¸æ“šæµ**:
```
ç”¨æˆ¶æ“ä½œ(Toggle/Opacity)
    â†“
Popupç™¼é€Message
    â†“
Content Scriptæ¥æ”¶
    â†“
å•Ÿç”¨/ç¦ç”¨Canvas
    â†“
æƒæç•¶å‰è¦–å£
    â†“
è¨ˆç®—æ¯å€‹æ–‡æœ¬å…ƒç´ çš„APCAå€¼
    â†“
åœ¨Canvasä¸Šç¹ªè£½å°æ‡‰é¡è‰²çŸ©å½¢
    â†“
é¡¯ç¤º/éš±è—Canvas
```

### 3.2 Popup UI æ¨¡å¡Š

**æ–‡ä»¶**: `src/popup/App.jsx`

**æ ¸å¿ƒè·è²¬**:
1. æä¾›ç”¨æˆ¶äº¤äº’ç•Œé¢
2. ç®¡ç†å•Ÿç”¨/ç¦ç”¨é–‹é—œ
3. æä¾›é€æ˜åº¦èª¿ç¯€æ»‘å¡Š
4. æ”¯æŒèªè¨€å’Œä¸»é¡Œåˆ‡æ›

**äº¤äº’è¨­è¨ˆ**:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Contrast Heatmap       â”‚ (æ¨™é¡Œ)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜‘ Enable Scanner        â”‚ (Toggleé–‹é—œ)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Opacity: â–”â–”â–”â–”â–‘â–‘â–‘â–‘â–‘â–‘     â”‚ (é€æ˜åº¦æ»‘å¡Š: 10%-80%)
â”‚          0.3            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Language: [EN â–¼]        â”‚ (èªè¨€é¸æ“‡)
â”‚ Theme:    [Light â–¼]     â”‚ (ä¸»é¡Œé¸æ“‡)
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Color Guide:            â”‚
â”‚ ğŸ”´ Fail (Lc < 30)       â”‚
â”‚ ğŸŸ¡ AA (Lc 45-59)        â”‚
â”‚ ğŸ”µ AAA (Lc â‰¥ 60)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**ç‹€æ…‹ç®¡ç†**:
```javascript
{
  isEnabled: Boolean,      // æƒææ˜¯å¦å•Ÿç”¨
  opacity: Number,         // 0.1-0.8
  language: String,        // 'en' | 'zh'
  theme: String,           // 'light' | 'dark'
  loading: Boolean         // åˆå§‹åŒ–ä¸­
}
```

### 3.3 è‰²å½©ç®—æ³•æ¨¡å¡Š

**æ–‡ä»¶**: `src/utils/color.js`

**APCAç®—æ³•æµç¨‹**:

```
Input: Text Color (RGB) + Background Color (RGB)
    â†“
[æ­¥é©Ÿ1] æ¨™æº–åŒ–è‰²å½©ç©ºé–“
    å°‡RGBå€¼(0-255)è½‰æ›ç‚ºsRGB(0-1)
    â†“
[æ­¥é©Ÿ2] Gammaè§£ç¢¼
    sRGB â‰¤ 0.03928 ? sRGB/12.92 : ((sRGB+0.055)/1.055)^2.4
    â†“
[æ­¥é©Ÿ3] è¨ˆç®—ç›¸å°äº®åº¦
    L = 0.2126*R + 0.7152*G + 0.0722*B (äººçœ¼æ„ŸçŸ¥åŠ æ¬Š)
    â†“
[æ­¥é©Ÿ4] è¨ˆç®—APCAå°æ¯”åº¦
    Lc = (Llight - Ldark) * 0.37 - 0.027
    â†“
[æ­¥é©Ÿ5] æ ¹æ“šæ–‡æœ¬å¤§å°èª¿æ•´
    Normal Text: Lc â‰¥ 45 (AA), â‰¥ 60 (AAA)
    Large Text:  Lc â‰¥ 30 (AA), â‰¥ 45 (AAA)
    â†“
Output: APCA Lcå€¼ (-108 ~ 108) + ç­‰ç´š (Fail/AA/AAA)
```

**é—œéµè¨­è¨ˆæ±ºç­–**:
- ä½¿ç”¨APCAè€ŒéWCAG 2.0å°æ¯”åº¦
- åŸå› : APCAåŸºæ–¼äººçœ¼æ„ŸçŸ¥æ©Ÿåˆ¶ï¼Œæ›´æº–ç¢º
- æ”¯æŒå¤§æ–‡æœ¬å’Œæ™®é€šæ–‡æœ¬çš„ä¸åŒæ¨™æº–

### 3.4 åœ‹éš›åŒ–æ¨¡å¡Š

**æ–‡ä»¶**: `src/utils/i18n.js`

**æ”¯æŒèªè¨€**:
- è‹±æ–‡ (en)
- ä¸­æ–‡ (zh)

**ç¿»è­¯éµä½**:
```
messages:
  - appName
  - appDescription
  - enableScanner
  - opacityLabel
  - languageLabel
  - themeLabel
  - colorGuide
  - loading
  - failLevel / aaLevel / aaaLevel
```

**å­˜å„²ç­–ç•¥**:
- é¦–æ¬¡ä½¿ç”¨: è‡ªå‹•æª¢æ¸¬ç€è¦½å™¨èªè¨€
- ç”¨æˆ¶é¸æ“‡: å„ªå…ˆç´šé«˜æ–¼è‡ªå‹•æª¢æ¸¬
- æŒä¹…åŒ–: å­˜å„²åˆ°Chrome Storage

---

## 4. é€šä¿¡æ©Ÿåˆ¶è¨­è¨ˆ

### 4.1 æ¶ˆæ¯é¡å‹å®šç¾©

```javascript
// Popup â†’ Content Script
{
  type: 'ENABLE_HEATMAP',      // å•Ÿç”¨æƒæ
  type: 'DISABLE_HEATMAP',     // ç¦ç”¨æƒæ
  type: 'UPDATE_OPACITY',      // æ›´æ–°é€æ˜åº¦
  opacity: Number              // 0.1-0.8
}

// éŒ¯èª¤è™•ç†: å¦‚æœContent ScriptæœªåŠ è¼‰ï¼Œè‡ªå‹•å¿½ç•¥
```

### 4.2 æ¶ˆæ¯æµåœ–

```
Timeline: Popup â†” Content Script

ç”¨æˆ¶æ“ä½œ (Popup)
    â†“
ä¿å­˜åˆ°Chrome Storage
    â†“
ç™¼é€Messageåˆ°Current Tab
    â†“
Content Scriptæ¥æ”¶
    â†“
æ›´æ–°æœ¬åœ°ç‹€æ…‹
    â†“
åŸ·è¡Œå°æ‡‰æ“ä½œ
    â†“
è¦–è¦ºåé¥‹ (Canvasé¡¯ç¤º/éš±è—/æ›´æ–°)
```

### 4.3 å­˜å„²è¨­è¨ˆ

**å­˜å„²éµä½**:
```javascript
chrome.storage.local = {
  enabled: Boolean,            // æƒæå•Ÿç”¨ç‹€æ…‹
  opacity: Number,             // ç†±åŠ›åœ–é€æ˜åº¦
  language: String,            // ç”¨æˆ¶é¸æ“‡çš„èªè¨€
  theme: String                // ç”¨æˆ¶é¸æ“‡çš„ä¸»é¡Œ
}
```

**å­˜å„²ç‰¹æ€§**:
- ä½œç”¨åŸŸ: æ¯å€‹æ“´å±•ç¨ç«‹å­˜å„²
- æ•¸æ“šé‡: éå¸¸å° (< 1KB)
- åŒæ­¥: åŒæ­¥API (ç„¡å»¶é²)

---

## 5. æ€§èƒ½å„ªåŒ–è¨­è¨ˆ

### 5.1 è¦–å£å„ªåŒ– (Viewport Optimization)

**å•é¡Œ**: æƒææ•´å€‹DOMæ¨¹æœƒå°è‡´æ€§èƒ½å•é¡Œ
**æ–¹æ¡ˆ**: åªæƒæç•¶å‰è¦–å£å…§çš„å…ƒç´ 

```javascript
function isElementInViewport(rect) {
  return (
    rect.top < window.innerHeight &&
    rect.bottom > 0 &&
    rect.left < window.innerWidth &&
    rect.right > 0
  );
}
```

**æ€§èƒ½æ”¶ç›Š**: æ¸›å°‘90%+ çš„è¨ˆç®—é‡(å¤§å¤šç¶²ç«™)

### 5.2 æ»¾å‹•é˜²æŠ– (Debounce)

**å•é¡Œ**: æ»¾å‹•äº‹ä»¶è§¸ç™¼é »ç‡éé«˜(60Hz+)
**æ–¹æ¡ˆ**: 100msé˜²æŠ–å»¶é²

```javascript
const debouncedScan = debounce(() => scanViewport(), 100);
window.addEventListener('scroll', debouncedScan);
```

**æ€§èƒ½æ”¶ç›Š**:
- æ¸›å°‘æƒææ¬¡æ•¸: 60æ¬¡/ç§’ â†’ 1-10æ¬¡/ç§’
- CPUå ç”¨: ~5% â†’ ~0.5%

### 5.3 Canvaså„ªåŒ–

**å„ªåŒ–ç­–ç•¥**:
1. Canvaså¤§å° = é é¢å¤§å°(åŒ…æ‹¬æ»¾å‹•å€åŸŸ)
2. åªæ›´æ–°å¯è¦‹çŸ©å½¢
3. ä½¿ç”¨requestAnimationFrameåŒæ­¥åˆ·æ–°

### 5.4 DOMéæ­·å„ªåŒ–

**ç­–ç•¥**: éæ­¸æŸ¥æ‰¾æœ‰æ•ˆèƒŒæ™¯è‰²æ™‚ï¼Œå¾ç•¶å‰å…ƒç´ å‘ä¸Šéæ­·
```javascript
function getEffectiveBackgroundColor(element) {
  let current = element;
  while (current && current !== document.documentElement) {
    const bg = window.getComputedStyle(current).backgroundColor;
    if (bg !== 'transparent' && bg !== 'rgba(0,0,0,0)') {
      return parseColor(bg);
    }
    current = current.parentElement;
  }
  return { r: 255, g: 255, b: 255 }; // é»˜èªç™½è‰²
}
```

---

## 6. ç„¡éšœç¤™è¨­è¨ˆ

### 6.1 WCAG 2.1 AAç­‰ç´šç¬¦åˆæ€§

| é …ç›® | ç‹€æ…‹ | èªªæ˜ |
|------|------|------|
| æ„ŸçŸ¥å¯æ€§ | âœ… | è¦–è¦ºç†±åŠ›åœ–æ¸…æ™°æ˜“è¾¨ |
| å¯æ“ä½œæ€§ | âœ… | éµç›¤å°èˆªæ”¯æŒ |
| å¯ç†è§£æ€§ | âœ… | å¤šèªè¨€UI + è‰²å½©æç¤º |
| é­¯æ£’æ€§ | âœ… | å…¼å®¹ä¸»æµç€è¦½å™¨ç‰ˆæœ¬ |

### 6.2 è‰²å½©è¨­è¨ˆ

```
Color Coding:
ğŸ”´ ç´…è‰² (Fail):     RGB(239, 68, 68)   å°æ¯”åº¦ä¸è¶³
ğŸŸ¡ é»ƒè‰² (AA):       RGB(234, 179, 8)   æ¨™æº–å°æ¯”åº¦
ğŸ”µ è—è‰² (AAA):      RGB(59, 130, 246)  å¢å¼·å°æ¯”åº¦
```

**è¨­è¨ˆåŸå‰‡**:
- ä¸ä¾è³´ç´”è‰²å½©è­˜åˆ¥(è¨­ç½®ä¸­æœ‰æ–‡å­—èªªæ˜)
- é«˜å°æ¯”åº¦é¡è‰²(ç¢ºä¿è‰²ç›²è€…è¾¨è­˜)

---

## 7. æ“´å±•æ€§æ¶æ§‹

### 7.1 æ”¯æŒçš„æ“´å±•é»

#### æ“´å±•1: æ–°å¢å°æ¯”åº¦æ¨™æº–
```javascript
// ç¾åœ¨: APCA
// å¯æ·»åŠ : WCAG 2.0, WCAG 3.0 (Silver)

// ä¿®æ”¹: color.js
export function calculateContrast(fg, bg, standard = 'APCA') {
  switch(standard) {
    case 'APCA': return calculateAPCAContrast(fg, bg);
    case 'WCAG2': return calculateWCAG2Contrast(fg, bg);
    case 'WCAG3': return calculateWCAG3Contrast(fg, bg);
  }
}
```

#### æ“´å±•2: æ–°å¢èªè¨€
```javascript
// ä¿®æ”¹: _locales/[lang]/messages.json
// æ–°å¢: _locales/ja/messages.json (æ—¥æ–‡)
// ä¿®æ”¹: i18n.js - æ”¯æŒæ–°èªè¨€ä»£ç¢¼
```

#### æ“´å±•3: å°å‡ºåŠŸèƒ½
```javascript
// æ–°å¢åŠŸèƒ½: å°‡ç†±åŠ›åœ–çµæœå°å‡ºç‚º
// - JSONå ±å‘Š
// - PNGæˆªåœ–
// - CSVå ±è¡¨
```

#### æ“´å±•4: è‡ªå®šç¾©è¦å‰‡
```javascript
// å…è¨±ç”¨æˆ¶è¨­ç½®è‡ªå·±çš„å°æ¯”åº¦é–¾å€¼
chrome.storage.local.set({
  customThresholds: {
    fail: { min: 0, max: 30 },
    aa: { min: 30, max: 60 },
    aaa: { min: 60, max: 108 }
  }
})
```

### 7.2 æ¶æ§‹å±¤ç´šé—œä¿‚

```
ç©©å®šåº¦ (ç”±é«˜åˆ°ä½)

Level 1: æ ¸å¿ƒç®—æ³•å±¤
â”œâ”€â”€ APCAç®—æ³•å¯¦ç¾ â­â­â­â­â­
â””â”€â”€ è‰²å½©è§£æå·¥å…· â­â­â­â­â­

Level 2: å¹³å°å±¤
â”œâ”€â”€ Chrome Message API â­â­â­â­
â”œâ”€â”€ Chrome Storage API â­â­â­â­
â””â”€â”€ Content ScriptåŸºç¤è¨­æ–½ â­â­â­â­

Level 3: æ¥­å‹™é‚è¼¯å±¤
â”œâ”€â”€ Canvasæ¸²æŸ“é‚è¼¯ â­â­â­
â”œâ”€â”€ DOMæƒæé‚è¼¯ â­â­â­
â””â”€â”€ æ»¾å‹•è™•ç†é‚è¼¯ â­â­â­

Level 4: è¡¨ç¾å±¤
â”œâ”€â”€ React Popup UI â­â­
â”œâ”€â”€ CSSæ¨£å¼ â­â­
â””â”€â”€ åœ‹éš›åŒ–ç³»çµ± â­â­
```

---

## 8. æŠ€è¡“æ£§é¸å‹ç†ç”±

| æŠ€è¡“ | é¸å‹ç†ç”± | æ›¿ä»£æ–¹æ¡ˆè©•ä¼° |
|------|--------|----------|
| Vite | æ¥µé€Ÿé–‹ç™¼é«”é©—ã€ESMåŸç”Ÿæ”¯æŒ | Webpack: é…ç½®è¤‡é›œ |
| React 18 | çµ„ä»¶åŒ–UIé–‹ç™¼ã€è±å¯Œç”Ÿæ…‹ | Vue: åŠŸèƒ½è¶³å¤ ä½†ç”Ÿæ…‹å° |
| Tailwind CSS | å¯¦ç”¨å„ªå…ˆã€åŸç”Ÿæ·±è‰²æ¨¡å¼ | Bootstrap: é«”ç©å¤§ã€å®šåˆ¶æ€§å¼± |
| åŸç”ŸJS Content Script | ç„¡é¡å¤–ä¾è³´ã€å¿«é€ŸåŠ è¼‰ | Vue/React: å¢åŠ 20KB+ |
| Manifest V3 | Googleå®˜æ–¹æ¨è–¦ã€å®‰å…¨æ€§é«˜ | MV2: é€æ­¥åœç”¨ |

---

## 9. éƒ¨ç½²èˆ‡æ§‹å»º

### 9.1 æ§‹å»ºæµç¨‹

```bash
npm install          # å®‰è£ä¾è³´
    â†“
npm run build        # Viteæ‰“åŒ…
    â†“
# è¼¸å‡º: dist/
# â”œâ”€â”€ manifest.json
# â”œâ”€â”€ src/
# â”‚  â”œâ”€â”€ content/index.js (Content Script)
# â”‚  â”œâ”€â”€ background/service-worker.js
# â”‚  â””â”€â”€ popup/
# â”‚     â”œâ”€â”€ popup.html
# â”‚     â””â”€â”€ main.js (Reactæ‡‰ç”¨)
# â””â”€â”€ public/ (éœæ…‹è³‡æº)
    â†“
ä¸Šå‚³åˆ° Chrome Web Store
    â†“
ç”¨æˆ¶é€šéå•†åº—å®‰è£
```

### 9.2 é–‹ç™¼å·¥ä½œæµ

```bash
npm run dev          # Viteç›£è¦–æ¨¡å¼
    â†“
chrome://extensions  # åŠ è¼‰æœªæ‰“åŒ…æ“´å±•
    â†“
ä¿®æ”¹ä»£ç¢¼ â†’ è‡ªå‹•ç·¨è­¯
    â†“
åˆ·æ–°æ“´å±• (or è‡ªå‹•åˆ·æ–°)
    â†“
æ¸¬è©¦ä¿®æ”¹
```

---

## 10. è³ªé‡ä¿è­‰è¨­è¨ˆ

### 10.1 æ¸¬è©¦ç­–ç•¥

| æ¸¬è©¦é¡å‹ | å…§å®¹ | å„ªå…ˆç´š |
|--------|------|------|
| å–®å…ƒæ¸¬è©¦ | APCAç®—æ³•ã€è‰²å½©è§£æã€åœ‹éš›åŒ– | P1 |
| é›†æˆæ¸¬è©¦ | æ¶ˆæ¯å‚³éã€å­˜å„²åŒæ­¥ã€UIäº¤äº’ | P1 |
| åŠŸèƒ½æ¸¬è©¦ | æƒææº–ç¢ºåº¦ã€æ€§èƒ½æŒ‡æ¨™ | P0 |
| å…¼å®¹æ€§æ¸¬è©¦ | Chromeç‰ˆæœ¬å…¼å®¹æ€§ | P1 |
| æ€§èƒ½æ¸¬è©¦ | Canvasæ¸²æŸ“ã€å…§å­˜å ç”¨ã€CPUä½¿ç”¨ | P1 |

### 10.2 æ€§èƒ½æŒ‡æ¨™

| æŒ‡æ¨™ | ç›®æ¨™ | æ¸¬é‡æ–¹æ³• |
|-----|------|--------|
| é¦–æ¬¡æƒæå»¶é² | < 100ms | Performance API |
| æ»¾å‹•å¹€ç‡ | > 50fps | RequestAnimationFrame |
| å…§å­˜å ç”¨ | < 20MB | Chrome DevTools |
| CPUå ç”¨(é–’ç½®) | < 0.1% | Chrome DevTools |
| åŒ…é«”ç© | < 500KB | dist/ æ–‡ä»¶å¤§å° |

---

## 11. å®‰å…¨è¨­è¨ˆ

### 11.1 æ¬Šé™ç”³è«‹

```javascript
"permissions": [
  "activeTab",      // è¨ªå•ç•¶å‰æ´»èºæ¨™ç±¤
  "scripting",      // æ³¨å…¥Content Script
  "storage"         // è¨ªå•æœ¬åœ°å­˜å„²
]
```

**é¢¨éšªè©•ä¼°**:
- âš ï¸ activeTab: ç”¨æˆ¶æ˜ç¢ºæ¿€æ´»æ™‚æ‰æœ‰æ¬Šé™
- âš ï¸ scripting: åªæ³¨å…¥è‡ªå·±çš„Content Script
- âœ… storage: åƒ…ç”¨æ–¼ä¿å­˜ç”¨æˆ¶è¨­ç½®

### 11.2 å…§å®¹å®‰å…¨ç­–ç•¥ (CSP)

```javascript
// manifest.jsonä¸­çš„éš±å«CSP
// é™åˆ¶: ä¸å…è¨±å…§è¯è…³æœ¬ã€å¤–éƒ¨è³‡æº
// ç›Šè™•: é˜²æ­¢XSSæ”»æ“Š
```

### 11.3 æ•¸æ“šéš±ç§

- âœ… æ‰€æœ‰è¨ˆç®—åœ¨æœ¬åœ°é€²è¡Œ
- âœ… ä¸æ”¶é›†ç”¨æˆ¶ç€è¦½æ•¸æ“š
- âœ… ä¸ç™¼é€ä»»ä½•é ç¨‹è«‹æ±‚
- âœ… è¨­ç½®å®Œå…¨å­˜å„²åœ¨æœ¬åœ°

---

## 12. æ•…éšœæ¢å¾©èˆ‡ç›£æ§

### 12.1 å¸¸è¦‹å•é¡Œè™•ç†

| å•é¡Œ | ç—‡ç‹€ | æ¢å¾©æ–¹æ¡ˆ |
|-----|------|--------|
| Content ScriptæœªåŠ è¼‰ | ç„¡æ³•åˆ‡æ›æƒæ | è‡ªå‹•ç•°å¸¸æ•ç²ï¼Œéœé»˜å¤±æ•— |
| Canvaså‰µå»ºå¤±æ•— | ç„¡ç†±åŠ›åœ–é¡¯ç¤º | try-catchä¿è­·ï¼Œä¸å½±éŸ¿é é¢ |
| å­˜å„²è¨ªå•å¤±æ•— | è¨­ç½®ä¸Ÿå¤± | ä½¿ç”¨é»˜èªå€¼ï¼Œä¸‹æ¬¡é‡è©¦ |
| å¤§é é¢æ€§èƒ½å•é¡Œ | å¡é “ | è¦–å£å„ªåŒ–ã€é˜²æŠ–å»¶é²è‡ªå‹•èª¿æ•´ |

### 12.2 èª¿è©¦èƒ½åŠ›

```javascript
// é–‹ç™¼æ¨¡å¼ä¸‹å•Ÿç”¨
if (DEBUG_MODE) {
  console.log(`[APCA] Text: ${textColor}, BG: ${bgColor}, Lc: ${lcValue}`);
  console.time('scanViewport');
  console.timeEnd('scanViewport');
}
```

---

## 13. æ¼”é€²è·¯ç·šåœ–

### 13.1 çŸ­æœŸ (1-3æœˆ)
- [ ] å®Œå–„æ¸¬è©¦è¦†è“‹ç‡ (ç›®æ¨™: 80%+)
- [ ] ç™¼ä½ˆv1.0åˆ°Chrome Web Store
- [ ] ç”¨æˆ¶åé¥‹æ”¶é›†æ©Ÿåˆ¶
- [ ] æ€§èƒ½åŸºæº–æ¸¬è©¦

### 13.2 ä¸­æœŸ (3-6æœˆ)
- [ ] WCAG 2.0å°æ¯”åº¦æ”¯æŒ
- [ ] æ›´å¤šèªè¨€æ”¯æŒ(æ—¥æ–‡ã€éŸ“æ–‡ã€ä¿„æ–‡)
- [ ] æ‰¹é‡æƒæå ±å‘ŠåŠŸèƒ½
- [ ] åœ˜éšŠå”ä½œåŠŸèƒ½(å…±äº«çµæœ)

### 13.3 é•·æœŸ (6æœˆ+)
- [ ] WCAG 3.0(Silver)ç®—æ³•æ”¯æŒ
- [ ] AIè¼”åŠ©è‰²å½©æ¨è–¦
- [ ] èˆ‡è¨­è¨ˆå·¥å…·é›†æˆ(Figmaæ’ä»¶)
- [ ] ç„¡éšœç¤™æª¢æ¸¬IDEé›†æˆ

---

## 14. é–‹ç™¼æŒ‡å—

### 14.1 ä»£ç¢¼çµ„ç¹”åŸå‰‡

```
src/
â”œâ”€â”€ content/          # Content Script (æ ¸å¿ƒæƒæé‚è¼¯)
â”‚   â””â”€â”€ index.js      # ä¸»å…¥å£
â”œâ”€â”€ popup/            # Popup UI
â”‚   â”œâ”€â”€ App.jsx       # Reactä¸»çµ„ä»¶
â”‚   â”œâ”€â”€ App.css       # æ¨£å¼
â”‚   â”œâ”€â”€ main.jsx      # Reactå…¥å£
â”‚   â””â”€â”€ popup.html    # HTMLæ¨¡æ¿
â”œâ”€â”€ background/       # Service Worker
â”‚   â””â”€â”€ service-worker.js
â”œâ”€â”€ utils/            # å…±ç”¨å·¥å…·
â”‚   â”œâ”€â”€ color.js      # APCAç®—æ³• (æ ¸å¿ƒ)
â”‚   â””â”€â”€ i18n.js       # åœ‹éš›åŒ–
â””â”€â”€ styles/           # å…¨å±€æ¨£å¼(å¯é¸)
```

### 14.2 æ–°åŠŸèƒ½é–‹ç™¼æµç¨‹

1. **éœ€æ±‚åˆ†æ**: æ˜ç¢ºæ–°åŠŸèƒ½çš„æ¶æ§‹å½±éŸ¿
2. **è¨­è¨ˆè©•å¯©**: ç¢ºä¿éµå¾ªç¾æœ‰æ¶æ§‹æ¨¡å¼
3. **ä»£ç¢¼å¯¦ç¾**: éµå¾ªå‘½åè¦ç¯„å’Œä»£ç¢¼é¢¨æ ¼
4. **æ¸¬è©¦è¦†è“‹**: å–®å…ƒæ¸¬è©¦ + é›†æˆæ¸¬è©¦
5. **æ€§èƒ½è©•ä¼°**: ç¢ºä¿ä¸è¶…éæ€§èƒ½é ç®—
6. **ä»£ç¢¼å¯©æŸ¥**: æ¶æ§‹ç›¸é—œæ€§æª¢æŸ¥

### 14.3 å‘½åè¦ç¯„

```javascript
// å¸¸é‡: å…¨å¤§å¯«è›‡å½¢
const DEFAULT_OPACITY = 0.3;
const APCA_AA_THRESHOLD = 45;

// å‡½æ•¸: å°é§å³° + å‹•è©é–‹é ­
function getEffectiveBackgroundColor() {}
function calculateAPCAContrast() {}
function isElementInViewport() {}

// é¡: å¤§é§å³°
class APCACalculator {}

// ç§æœ‰å‡½æ•¸: ä¸‹åŠƒç·šå‰ç¶´
function _parseRgbString() {}

// æ¶ˆæ¯é¡å‹: SCREAMING_SNAKE_CASE
const MESSAGE_TYPE = {
  ENABLE_HEATMAP: 'ENABLE_HEATMAP',
  UPDATE_OPACITY: 'UPDATE_OPACITY'
};
```

---

## 15. æ•…éšœæ’æŸ¥æŒ‡å—

### 15.1 å¸¸è¦‹èª¿è©¦å ´æ™¯

**å ´æ™¯1**: ç†±åŠ›åœ–ä¸é¡¯ç¤º
```
1. æª¢æŸ¥: æ˜¯å¦å•Ÿç”¨äº†æƒæ? (Popupé–‹é—œ)
2. æª¢æŸ¥: Canvasæ˜¯å¦æˆåŠŸå‰µå»º? (DevTools > Elements)
3. æª¢æŸ¥: z-indexæ˜¯å¦è¢«è¦†è“‹? (DevTools > Computed)
4. æª¢æŸ¥: é é¢Content Security Policy? (DevTools > Console)
```

**å ´æ™¯2**: å°æ¯”åº¦è¨ˆç®—ä¸æº–ç¢º
```
1. é©—è­‰: è‰²å½©è§£ææ˜¯å¦æ­£ç¢º? (console.log parseColorçµæœ)
2. é©—è­‰: APCAç®—æ³•æ˜¯å¦æœ‰èª¤? (å°æ¨™å®˜æ–¹å¯¦ç¾)
3. æª¢æŸ¥: èƒŒæ™¯è‰²æŸ¥æ‰¾æ˜¯å¦éæ­¸æ­£ç¢º?
4. æ¸¬è©¦: ç”¨å·²çŸ¥å°æ¯”åº¦çš„æ–‡æœ¬é©—è­‰
```

**å ´æ™¯3**: æ€§èƒ½å•é¡Œ(å¡é “)
```
1. æª¢æŸ¥: é é¢DOMç¯€é»æ•¸é‡? (console.log document.querySelectorAll('*').length)
2. åˆ†æ: Performanceé¢æ¿è¨˜éŒ„æƒæè€—æ™‚
3. å„ªåŒ–: å¢åŠ è¦–å£æŸ¥æ‰¾çš„æ—©æœŸé€€å‡ºæ¢ä»¶
4. æ¸¬è©¦: æ¸›å°é˜²æŠ–å»¶é²æˆ–å¢åŠ é˜ˆå€¼
```

---

## 16. æ–‡æª”èˆ‡åƒè€ƒ

### 16.1 å¤–éƒ¨åƒè€ƒè³‡æº

- [APCAå®˜æ–¹æ–‡æª”](https://www.myndex.com/APCA/)
- [Chrome Manifest V3](https://developer.chrome.com/docs/extensions/mv3/)
- [WCAG 2.1ç„¡éšœç¤™æŒ‡å—](https://www.w3.org/WAI/WCAG21/quickref/)
- [Chrome Storage API](https://developer.chrome.com/docs/extensions/reference/storage/)

### 16.2 å…§éƒ¨æ–‡æª”

- README.md: ç”¨æˆ¶ä½¿ç”¨æŒ‡å—
- README.zh.md: ä¸­æ–‡ä½¿ç”¨æŒ‡å—
- CONTRIBUTING.md: é–‹ç™¼è€…è²¢ç»æŒ‡å—(å¾…å»º)
- API.md: å…§éƒ¨APIæ–‡æª”(å¾…å»º)

---

## 17. çµè«–

### 17.1 æ¶æ§‹å„ªå‹¢

âœ… **æ¨¡å¡ŠåŒ–è¨­è¨ˆ**: æ¸…æ™°çš„å±¤æ¬¡çµæ§‹ï¼Œæ˜“æ–¼æ“´å±•å’Œç¶­è­·
âœ… **æ€§èƒ½å„ªåŒ–**: è¦–å£å„ªåŒ–å’Œé˜²æŠ–æ©Ÿåˆ¶ç¢ºä¿æµæš¢é«”é©—
âœ… **ç”¨æˆ¶å‹å¥½**: å¤šèªè¨€ã€æ·±è‰²æ¨¡å¼ã€ç›´è§€çš„UI
âœ… **ç„¡éšœç¤™å„ªå…ˆ**: æœ¬èº«å°±æ˜¯ç„¡éšœç¤™å·¥å…·ï¼Œè¨­è¨ˆä¸Šå®Œå…¨ç¬¦åˆæ¨™æº–
âœ… **å®‰å…¨éš±ç§**: å®Œå…¨æœ¬åœ°è¨ˆç®—ï¼Œç„¡æ•¸æ“šå‚³è¼¸

### 17.2 æŠ€è¡“é¢¨éšªèˆ‡ç·©è§£

| é¢¨éšª | å½±éŸ¿ | ç·©è§£ç­–ç•¥ |
|-----|------|--------|
| Chrome APIè®ŠåŒ– | åŠŸèƒ½å¤±æ•ˆ | ç›£æ§Chromeç™¼å¸ƒæ—¥èªŒï¼ŒåŠæ™‚é©é… |
| å¤§å‹é é¢æ€§èƒ½ | ç”¨æˆ¶é«”é©—å·® | é€²ä¸€æ­¥å„ªåŒ–è¦–å£æŸ¥è©¢ã€Web Worker |
| ç”¨æˆ¶éš±ç§é¡§æ…® | æ¡ç”¨ç‡ä½ | é€æ˜éš±ç§æ”¿ç­–ã€é–‹æºä»£ç¢¼ |
| å°æ¯”åº¦ç®—æ³•çˆ­è­° | å¯ä¿¡åº¦å•é¡Œ | æ”¯æŒå¤šç¨®ç®—æ³•ã€å°æ¨™å®˜æ–¹å¯¦ç¾ |

### 17.3 æˆåŠŸæŒ‡æ¨™

- ğŸ“Š Chrome Web Storeè©•åˆ†: â‰¥ 4.5æ˜Ÿ
- ğŸ“¥ å®‰è£é‡: > 10,000
- â­ ç¤¾å€è²¢ç»: > 5å€‹PR/æœˆ
- ğŸ› Bugè§£æ±ºç‡: â‰¥ 90%
- ğŸ“ˆ ç”¨æˆ¶ç•™å­˜ç‡: â‰¥ 70%

---

**æ–‡æª”æ›´æ–°æ—¥æœŸ**: 2025å¹´12æœˆ
**ä¸‹ä¸€æ¬¡å¯©æŸ¥æ—¥æœŸ**: 2026å¹´6æœˆ
